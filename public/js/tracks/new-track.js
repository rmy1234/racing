// @ts-nocheck
const newtrack = {
    name: '새 트랙',
    id: 'new-track',
    width: 4500,
    height: 3000,
    
    centerPath: [
      { x: 3970, y: 477, type: 'straight' },
      { x: 3954, y: 1249, type: 'straight' },
      { x: 3934, y: 2278, type: 'curve' },
      { x: 3917, y: 2517, type: 'curve' },
      { x: 3822, y: 2645, type: 'curve' },
      { x: 3649, y: 2722, type: 'curve' },
      { x: 3486, y: 2710, type: 'curve' },
      { x: 3343, y: 2669, type: 'curve' },
      { x: 3168, y: 2591, type: 'curve' },
      { x: 2986, y: 2582, type: 'curve' },
      { x: 2778, y: 2691, type: 'curve' },
      { x: 2634, y: 2836, type: 'curve' },
      { x: 2516, y: 2875, type: 'curve' },
      { x: 2389, y: 2844, type: 'curve' },
      { x: 2297, y: 2768, type: 'curve' },
      { x: 2227, y: 2688, type: 'curve' },
      { x: 2138, y: 2616, type: 'curve' },
      { x: 2058, y: 2597, type: 'curve' },
      { x: 1969, y: 2601, type: 'curve' },
      { x: 1801, y: 2592, type: 'curve' },
      { x: 1656, y: 2505, type: 'curve' },
      { x: 1583, y: 2419, type: 'curve' },
      { x: 1529, y: 2330, type: 'curve' },
      { x: 1488, y: 2241, type: 'curve' },
      { x: 1461, y: 2155, type: 'curve' },
      { x: 1452, y: 2051, type: 'curve' },
      { x: 1453, y: 1960, type: 'curve' },
      { x: 1454, y: 1833, type: 'straight' },
      { x: 1449, y: 399, type: 'straight' },
      { x: 1695, y: 103, type: 'curve' },
      { x: 2154, y: 116, type: 'curve' },
      { x: 2350, y: 126, type: 'curve' },
      { x: 2530, y: 131, type: 'curve' },
      { x: 2626, y: 145, type: 'curve' },
      { x: 2717, y: 166, type: 'curve' },
      { x: 2797, y: 176, type: 'curve' },
      { x: 2956, y: 216, type: 'curve' }
    ],
    
    trackWidth: 120,
    
    checkpoints: [
      { x: 3935, y: 2282, angle: 1.596 },
      { x: 3347, y: 2668, angle: -2.763 },
      { x: 2778, y: 2694, angle: 2.493 },
      { x: 1578, y: 2415, angle: -2.183 },
      { x: 1450, y: 401, angle: -1.574 },
      { x: 2534, y: 127, angle: 0.066 },
      { x: 3635, y: 332, angle: 0.256 }
    ],
    
    curbs: [
      { centerPath: [{ x: 4014.5204512312553, y: 1224.5099229961572 }, { x: 4013.987117897922, y: 1250.2432563294906 }], width: 20, trackSide: 'outer' },
      { centerPath: [{ x: 4019.3204512312554, y: 992.9099229961572 }, { x: 4013.987117897922, y: 1250.2432563294906 }, { x: 4013.9889302040983, y: 1250.1524985760614 }, { x: 4011.6227254929863, y: 1374.18649714774 }, { x: 4009.7571154057177, y: 1476.641987452037 }], width: 20, trackSide: 'outer' },
      { centerPath: [{ x: 4009.7571154057177, y: 1476.641987452037 }, { x: 4005.5789383181354, y: 1712.3503473166218 }, { x: 4005.2112890788553, y: 1733.1246079881496 }], width: 20, trackSide: 'outer' },
      { centerPath: [{ x: 4007.509096824355, y: 1603.2854787911008 }, { x: 4003.5881263368537, y: 1823.2330721914477 }, { x: 4002.8924851617103, y: 1861.8509854214326 }], width: 20, trackSide: 'outer' },
      { centerPath: [{ x: 3842.48434616434, y: 2539.0184310700783 }, { x: 3832.007917331941, y: 2554.136006702206 }, { x: 3819.455962975341, y: 2568.251624047028 }, { x: 3804.0686703586234, y: 2582.4624497911336 }, { x: 3786.237910603331, y: 2596.822484891968 }, { x: 3765.7098322450347, y: 2610.969361866896 }, { x: 3719.3457768295443, y: 2635.504149589325 }, { x: 3715.3847846748477, y: 2637.4199326814296 }, { x: 3688.1003485599695, y: 2648.5039731608595 }, { x: 3661.5892687735472, y: 2657.2402869468783 }, { x: 3638.0763562753286, y: 2663.002762710645 }, { x: 3617.09002012821, y: 2665.615162363168 }, { x: 3595.470005114577, y: 2665.7101858002065 }], width: 20, trackSide: 'inner' },
      { centerPath: [{ x: 3661.5892687735472, y: 2657.2402869468783 }, { x: 3638.0763562753286, y: 2663.002762710645 }, { x: 3617.09002012821, y: 2665.615162363168 }, { x: 3595.470005114577, y: 2665.7101858002065 }, { x: 3572.4059207078762, y: 2663.759405443261 }, { x: 3548.035748737862, y: 2660.2100289649807 }, { x: 3522.5202764658025, y: 2655.6568979948943 }, { x: 3490.283622092631, y: 2649.730305506447 }, { x: 3473.7996481788578, y: 2646.572695515849 }, { x: 3452.726508665753, y: 2641.6778076115797 }, { x: 3432.084019508769, y: 2636.034933259473 }, { x: 3410.9582693257503, y: 2629.457532454359 }, { x: 3388.5073386421745, y: 2621.7606341192877 }, { x: 3365.1854355526157, y: 2613.252296465767 }], width: 20, trackSide: 'inner' },
      { centerPath: [{ x: 3230.8906657231846, y: 2681.5580876768627 }, { x: 3202.987496182815, y: 2667.780085582717 }, { x: 3177.0840537195522, y: 2656.69299059323 }, { x: 3152.1697632422797, y: 2648.8740322095714 }, { x: 3125.991689900366, y: 2642.849899445964 }, { x: 3099.4922241818394, y: 2637.78983792251 }, { x: 3067.6807768771496, y: 2634.370168636248 }, { x: 3049.8920528811136, y: 2633.6946862078994 }, { x: 3025.7707334163774, y: 2635.356716584821 }, { x: 3001.04426010669, y: 2640.0833042951435 }, { x: 2973.229943518942, y: 2649.0765105741816 }, { x: 2941.6774054635835, y: 2662.591879720164 }], width: 20, trackSide: 'outer' },
      { centerPath: [{ x: 3025.7707334163774, y: 2635.356716584821 }, { x: 3001.04426010669, y: 2640.0833042951435 }, { x: 2973.229943518942, y: 2649.0765105741816 }, { x: 2941.6774054635835, y: 2662.591879720164 }, { x: 2882.9884348771534, y: 2694.145987469954 }, { x: 2874.582184515736, y: 2698.9847490956313 }, { x: 2842.3695417436065, y: 2719.4244006365866 }, { x: 2814.2445477157617, y: 2738.815612103997 }, { x: 2790.701014064736, y: 2758.3902325017125 }], width: 20, trackSide: 'outer' },
      { centerPath: [{ x: 2741.7554522842383, y: 2643.184387896003 }, { x: 2709.289726676004, y: 2670.230137868657 }, { x: 2680.2802100319896, y: 2699.817794616721 }, { x: 2635.7101168098357, y: 2751.021141551519 }, { x: 2633.0667745371784, y: 2754.0909891640326 }, { x: 2614.275432054614, y: 2774.198000205361 }, { x: 2598.1604355405193, y: 2787.8800912370493 }, { x: 2583.1087373678592, y: 2797.3817794084657 }, { x: 2569.0307644452123, y: 2804.4724582870326 }, { x: 2556.343379757525, y: 2809.137582574535 }, { x: 2543.765504065722, y: 2812.1793493482337 }, { x: 2529.938785258373, y: 2814.07330718969 }], width: 20, trackSide: 'inner' },
      { centerPath: [{ x: 2499.7952576312177, y: 2814.6011252916646 }, { x: 2483.3858804804036, y: 2812.4177449247263 }, { x: 2465.761026839374, y: 2808.5634412554714 }, { x: 2447.923352625336, y: 2803.2969498073335 }, { x: 2430.8031816404637, y: 2796.9829506500855 }, { x: 2416.027760363351, y: 2790.432284258695 }, { x: 2403.776517166987, y: 2783.477444354805 }, { x: 2391.8287715406923, y: 2774.8387412026714 }, { x: 2379.316398075864, y: 2764.2331180250626 }, { x: 2365.2171700101567, y: 2750.9526961397078 }, { x: 2352.7375184165453, y: 2738.651360121725 }, { x: 2339.6168766806113, y: 2725.7649219014625 }, { x: 2328.6625481243204, y: 2714.4298494815534 }, { x: 2318.899986625457, y: 2703.001570794229 }, { x: 2308.5585262141476, y: 2690.1360526774147 }, { x: 2297.0700628334803, y: 2675.872272690875 }, { x: 2283.834254375626, y: 2660.4753510242895 }, { x: 2269.1364827923217, y: 2645.2856368665953 }], width: 20, trackSide: 'inner' },
      { centerPath: [{ x: 2655.0946268093235, y: 2728.5089257264194 }, { x: 2633.0667745371784, y: 2754.0909891640326 }, { x: 2614.275432054614, y: 2774.198000205361 }, { x: 2598.1604355405193, y: 2787.8800912370493 }, { x: 2583.1087373678592, y: 2797.3817794084657 }, { x: 2569.0307644452123, y: 2804.4724582870326 }, { x: 2556.343379757525, y: 2809.137582574535 }, { x: 2543.765504065722, y: 2812.1793493482337 }, { x: 2529.938785258373, y: 2814.07330718969 }, { x: 2505.756574183672, y: 2814.759433296224 }, { x: 2499.7952576312177, y: 2814.6011252916646 }, { x: 2483.3858804804036, y: 2812.4177449247263 }, { x: 2465.761026839374, y: 2808.5634412554714 }, { x: 2447.923352625336, y: 2803.2969498073335 }, { x: 2430.8031816404637, y: 2796.9829506500855 }, { x: 2416.027760363351, y: 2790.432284258695 }, { x: 2403.776517166987, y: 2783.477444354805 }, { x: 2391.8287715406923, y: 2774.8387412026714 }, { x: 2379.316398075864, y: 2764.2331180250626 }], width: 20, trackSide: 'inner' },
      { centerPath: [{ x: 2268.57266676864, y: 2824.186602841238 }, { x: 2254.3831233193887, y: 2810.2350780985375 }, { x: 2239.897637060865, y: 2795.181261629558 }, { x: 2226.5814948560246, y: 2779.665095872438 }, { x: 2215.0664737858524, y: 2765.3639473225853 }, { x: 2204.781789018372, y: 2752.5721717535694 }, { x: 2195.1888937725216, y: 2741.3579823090436 }, { x: 2184.8635172076783, y: 2730.7143631334047 }, { x: 2162.245318224661, y: 2709.6707459897 }, { x: 2158.5151445172064, y: 2706.2619339044654 }, { x: 2144.642976513498, y: 2694.2215511837085 }, { x: 2131.3030644678815, y: 2683.474669324539 }, { x: 2119.2791420873764, y: 2674.7824477902595 }, { x: 2109.393256506393, y: 2668.7413900716597 }, { x: 2101.4164964806723, y: 2664.985413551967 }, { x: 2094.0106873927557, y: 2662.433334816653 }, { x: 2086.1846917222206, y: 2660.5751518510665 }, { x: 2077.0083538822523, y: 2659.1320649443933 }, { x: 2065.8527668783945, y: 2657.9317075784825 }, { x: 2054.1708503936848, y: 2656.8776887771437 }, { x: 2044.8575313485746, y: 2656.485566341929 }], width: 20, trackSide: 'outer' },
      { centerPath: [{ x: 2109.393256506393, y: 2668.7413900716597 }, { x: 2101.4164964806723, y: 2664.985413551967 }, { x: 2094.0106873927557, y: 2662.433334816653 }, { x: 2086.1846917222206, y: 2660.5751518510665 }, { x: 2077.0083538822523, y: 2659.1320649443933 }, { x: 2065.8527668783945, y: 2657.9317075784825 }, { x: 2054.1708503936848, y: 2656.8776887771437 }, { x: 2044.8575313485746, y: 2656.485566341929 }, { x: 2036.3406896859847, y: 2656.9484728589596 }, { x: 2024.8812536552155, y: 2658.0860614161484 }, { x: 2009.6466712702302, y: 2659.5858851441303 }, { x: 1990.5535262362553, y: 2660.784609102993 }, { x: 1955.8025915376327, y: 2661.0858251936347 }, { x: 1946.3075944353986, y: 2661.1467246597676 }, { x: 1919.0902844970728, y: 2661.841945031604 }, { x: 1887.9052336848963, y: 2662.184552036166 }, { x: 1854.2025298954743, y: 2661.1244584454166 }, { x: 1818.9992557445526, y: 2657.3939513505165 }], width: 20, trackSide: 'outer' },
      { centerPath: [{ x: 1838.1674109221144, y: 2538.934752353187 }, { x: 1818.2288742727815, y: 2534.5268245936186 }, { x: 1798.8940416600217, y: 2527.110180047199 }, { x: 1777.2356191966326, y: 2516.181102328076 }, { x: 1754.784703960092, y: 2502.6989684896002 }, { x: 1732.6876038502785, y: 2487.753363554171 }, { x: 1707.0546128582023, y: 2468.706971518649 }, { x: 1694.0034601269538, y: 2458.570084876461 }, { x: 1680.603504626515, y: 2446.9843578443274 }, { x: 1670.2524834225533, y: 2436.2605097451406 }, { x: 1661.0213698759972, y: 2425.09362674662 }, { x: 1651.9792480875449, y: 2412.832390283009 }, { x: 1642.3373162896266, y: 2399.0157485008567 }, { x: 1632.0943264491407, y: 2384.5072890235456 }, { x: 1622.470042317967, y: 2370.7557963629993 }], width: 20, trackSide: 'inner' },
      { centerPath: [{ x: 1651.9792480875449, y: 2412.832390283009 }, { x: 1642.3373162896266, y: 2399.0157485008567 }, { x: 1632.0943264491407, y: 2384.5072890235456 }, { x: 1622.470042317967, y: 2370.7557963629993 }, { x: 1613.8235054637976, y: 2357.489170367674 }, { x: 1605.5172967141377, y: 2343.9309049467843 }, { x: 1597.478662944057, y: 2330.0984145806165 }, { x: 1589.6338525108297, y: 2316.0132309818287 }, { x: 1582.0030678026114, y: 2301.8810597014794 }, { x: 1574.7304114558888, y: 2287.927290804893 }, { x: 1566.0235478665002, y: 2270.1962719000894 }, { x: 1561.3178082837042, y: 2260.229211361977 }, { x: 1555.1402247324165, y: 2246.4471214072814 }, { x: 1549.3374639970496, y: 2232.776140523743 }, { x: 1543.8354277659178, y: 2219.036279773295 }, { x: 1538.5821748591927, y: 2205.424354261384 }, { x: 1533.7582973514293, y: 2192.478949317737 }, { x: 1529.5111998022433, y: 2180.2366150715084 }, { x: 1525.8219353395095, y: 2168.343972116492 }, { x: 1522.6506742053903, y: 2156.384398054786 }, { x: 1519.974178172964, y: 2143.9525428797624 }, { x: 1517.7704031027642, y: 2130.2913512742125 }], width: 20, trackSide: 'inner' },
      { centerPath: [{ x: 1394.0003284953314, y: 1833.1985430226698 }, { x: 1392.3003647195142, y: 1345.6492037492346 }], width: 20, trackSide: 'outer' },
      { centerPath: [{ x: 1394.0003284953314, y: 1833.1985430226698 }, { x: 1391.8670313861808, y: 1221.3692037492347 }], width: 20, trackSide: 'outer' },
      { centerPath: [{ x: 1390.667031386181, y: 877.2092037492346 }, { x: 1390.667031386181, y: 877.2092037492346 }], width: 20, trackSide: 'outer' },
      { centerPath: [{ x: 1392.3336980528475, y: 1355.2092037492346 }, { x: 1390.6503647195143, y: 872.4292037492346 }], width: 20, trackSide: 'outer' },
      { centerPath: [{ x: 1508.0595084272204, y: 409.58179872871705 }, { x: 1522.6528214917773, y: 327.7680160200977 }, { x: 1544.3022516586411, y: 260.2787470388746 }, { x: 1556.0520402533862, y: 235.32199443515944 }, { x: 1572.2164572270933, y: 214.50159993759178 }, { x: 1588.6110980785284, y: 202.09363287377013 }, { x: 1609.60622096234, y: 192.57571802849836 }, { x: 1638.3181871084003, y: 183.6587319136284 }], width: 20, trackSide: 'inner' },
      { centerPath: [{ x: 1588.6110980785284, y: 202.09363287377013 }, { x: 1609.60622096234, y: 192.57571802849836 }, { x: 1638.3181871084003, y: 183.6587319136284 }, { x: 1674.8996869294638, y: 173.32983525898814 }, { x: 1742.6058282479632, y: 153.30461770514646 }, { x: 1769.6892206509315, y: 146.85241660406234 }, { x: 1840.85477764576, y: 144.54532072681405 }], width: 20, trackSide: 'inner' },
      { centerPath: [{ x: 2851.8646999438783, y: 127.12258226366754 }, { x: 2894.1166221468475, y: 138.1046283187789 }, { x: 2999.8102769991124, y: 163.72664546171694 }, { x: 3047.281109727998, y: 173.41997875219178 }, { x: 3152.646245635496, y: 190.0110334587191 }], width: 20, trackSide: 'outer' },
      { centerPath: [{ x: 3047.281109727998, y: 173.41997875219178 }, { x: 3237.7441983853537, y: 202.50113432116908 }, { x: 3277.7902937970516, y: 208.37882884467496 }], width: 20, trackSide: 'outer' },
      { centerPath: [{ x: 3152.646245635496, y: 190.0110334587191 }, { x: 3414.4912609210814, y: 229.6347468486303 }, { x: 3414.4912609210814, y: 229.6347468486303 }, { x: 3554.9854450916055, y: 255.02195896426647 }], width: 20, trackSide: 'outer' }
    ],
    
    startLine: {
      x: 3963.364169486476,
      y: 797.1788222775224,
      width: 120,
      angle: 1.592
    },
  
  // 트랙 경계 생성 (부드러운 경로 사용)
  getTrackBounds() {
    // 부드러운 경로 생성 (더 정확한 경계 계산)
    const smoothPath = this.getSmoothPath(200);
    const innerPath = [];
    const outerPath = [];

    for (let i = 0; i < smoothPath.length; i++) {
      const curr = smoothPath[i];
      const prev = smoothPath[(i - 1 + smoothPath.length) % smoothPath.length];
      const next = smoothPath[(i + 1) % smoothPath.length];

      // 이전 포인트에서 현재 포인트로의 방향 벡터
      const dx1 = curr.x - prev.x;
      const dy1 = curr.y - prev.y;
      const len1 = Math.sqrt(dx1 * dx1 + dy1 * dy1);
      
      // 현재 포인트에서 다음 포인트로의 방향 벡터
      const dx2 = next.x - curr.x;
      const dy2 = next.y - curr.y;
      const len2 = Math.sqrt(dx2 * dx2 + dy2 * dy2);
      
      // 두 방향 벡터의 평균을 사용하여 더 정확한 법선 벡터 계산
      let nx, ny;
      if (len1 > 0.001 && len2 > 0.001) {
        // 각 방향 벡터의 법선 벡터 계산 후 평균화
        const nx1 = -dy1 / len1;
        const ny1 = dx1 / len1;
        const nx2 = -dy2 / len2;
        const ny2 = dx2 / len2;
        
        // 평균 법선 벡터 (정규화)
        const avgNx = (nx1 + nx2) / 2;
        const avgNy = (ny1 + ny2) / 2;
        const avgLen = Math.sqrt(avgNx * avgNx + avgNy * avgNy);
        nx = avgLen > 0.001 ? avgNx / avgLen : nx1;
        ny = avgLen > 0.001 ? avgNy / avgLen : ny1;
      } else if (len1 > 0.001) {
        nx = -dy1 / len1;
        ny = dx1 / len1;
      } else if (len2 > 0.001) {
        nx = -dy2 / len2;
        ny = dx2 / len2;
      } else {
        // 기본값 (발생하지 않아야 함)
        nx = 0;
        ny = 1;
      }

      const halfWidth = this.trackWidth / 2;

      innerPath.push({ x: curr.x + nx * halfWidth, y: curr.y + ny * halfWidth });
      outerPath.push({ x: curr.x - nx * halfWidth, y: curr.y - ny * halfWidth });
    }
    return { innerPath, outerPath };
  },

  // 포인트가 트랙 위에 있는지 확인 (부드러운 경로 사용)
  isOnTrack(x, y) {
    // 부드러운 경로를 사용하여 더 정확한 판정
    const smoothPath = this.getSmoothPath(200);
    let minDist = Infinity;
    
    // 각 세그먼트(두 포인트 사이의 선분)까지의 거리 계산
    for (let i = 0; i < smoothPath.length; i++) {
      const p1 = smoothPath[i];
      const p2 = smoothPath[(i + 1) % smoothPath.length];
      
      // 세그먼트까지의 최소 거리 계산
      const dx = p2.x - p1.x;
      const dy = p2.y - p1.y;
      const segLenSq = dx * dx + dy * dy;
      
      if (segLenSq < 0.001) {
        // 세그먼트 길이가 거의 0이면 포인트 간 거리만 계산
        const dist = Math.sqrt((x - p1.x) ** 2 + (y - p1.y) ** 2);
        minDist = Math.min(minDist, dist);
      } else {
        // 세그먼트 위의 가장 가까운 점 찾기
        const t = Math.max(0, Math.min(1, ((x - p1.x) * dx + (y - p1.y) * dy) / segLenSq));
        const closestX = p1.x + t * dx;
        const closestY = p1.y + t * dy;
        const dist = Math.sqrt((x - closestX) ** 2 + (y - closestY) ** 2);
        minDist = Math.min(minDist, dist);
      }
    }
    
    return minDist < this.trackWidth / 2 + 50;
  },

  // 가장 가까운 체크포인트 인덱스 반환
  getNearestCheckpoint(x, y) {
    let minDist = Infinity;
    let nearestIdx = 0;
    for (let i = 0; i < this.checkpoints.length; i++) {
      const cp = this.checkpoints[i];
      const dx = x - cp.x;
      const dy = y - cp.y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      if (dist < minDist) { minDist = dist; nearestIdx = i; }
    }
    return nearestIdx;
  },

  // 체크포인트 통과 확인
  checkCheckpoint(x, y, lastCheckpoint) {
    const checkpointRadius = 300;
    const nextCheckpoint = (lastCheckpoint + 1) % this.checkpoints.length;
    const cp = this.checkpoints[nextCheckpoint];
    const dx = x - cp.x;
    const dy = y - cp.y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    if (dist < checkpointRadius) return nextCheckpoint;
    return lastCheckpoint;
  },
  
  // 부드러운 경로 생성 (에디터와 동일한 방식: type 속성 고려)
  getSmoothPath(targetPoints = 200) {
    if (this.centerPath.length < 2) return this.centerPath;
    
    const smoothPath = [];
    const numPoints = this.centerPath.length;
    
    for (let i = 0; i < numPoints; i++) {
      const p1 = this.centerPath[i];
      const p2 = this.centerPath[(i + 1) % numPoints];
      const p0 = this.centerPath[(i - 1 + numPoints) % numPoints];
      const p3 = this.centerPath[(i + 2) % numPoints];
      
      const p1Type = p1.type || 'straight';
      const p2Type = p2.type || 'straight';
      
      // 전환 구간 감지: 직선->곡선 또는 곡선->직선
      const isTransition = (p1Type === 'straight' && p2Type === 'curve') || 
                           (p1Type === 'curve' && p2Type === 'straight');
      
      // 곡선 구간 또는 전환 구간인지 확인
      const isCurve = p1Type === 'curve' || p2Type === 'curve' || isTransition;
      
      if (isCurve && numPoints >= 4) {
        // 곡선 구간 또는 전환 구간: Catmull-Rom 스플라인 사용
        const steps = Math.ceil(targetPoints / numPoints);
        
        // 전환 구간인 경우 더 많은 포인트로 부드럽게 처리
        const transitionSteps = isTransition ? steps * 1.5 : steps;
        
        for (let j = 0; j < transitionSteps; j++) {
          const t = j / transitionSteps;
          const t2 = t * t;
          const t3 = t2 * t;
          
          const x = 0.5 * (
            (2 * p1.x) +
            (-p0.x + p2.x) * t +
            (2 * p0.x - 5 * p1.x + 4 * p2.x - p3.x) * t2 +
            (-p0.x + 3 * p1.x - 3 * p2.x + p3.x) * t3
          );
          
          const y = 0.5 * (
            (2 * p1.y) +
            (-p0.y + p2.y) * t +
            (2 * p0.y - 5 * p1.y + 4 * p2.y - p3.y) * t2 +
            (-p0.y + 3 * p1.y - 3 * p2.y + p3.y) * t3
          );
          
          smoothPath.push({ x, y });
        }
      } else {
        // 순수 직선 구간: 단순 선형 보간
        const steps = Math.max(2, Math.ceil(targetPoints / numPoints / 2));
        for (let j = 0; j <= steps; j++) {
          const t = j / steps;
          smoothPath.push({
            x: p1.x + (p2.x - p1.x) * t,
            y: p1.y + (p2.y - p1.y) * t
          });
        }
      }
    }
    
    return smoothPath;
  }
};

// 트랙 등록
if (typeof registerTrack === 'function') {
  registerTrack('new-track', newtrack);
}